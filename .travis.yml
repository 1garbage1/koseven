# Minimal system required
language: php

# Use containerized infrastructure
sudo: false

# Supported PHP-Versions
php:
  - 7.3

# Run Docker Service
services:
  - docker

# Pull Docker Machine from DockerHub and mount project files / init composer
before_install:
  - docker pull koseven/docker:travis-devel
  - docker run -dtP --name unittest -v $(pwd):/tmp/koseven/ koseven/docker:travis-devel
  - docker exec unittest /bin/sh -c "service redis-server start; cd /tmp/koseven; composer install"

# Execute commands which should make the build pass or fail
script:
  - docker exec unittest /bin/sh -c "cd /tmp/koseven; php vendor/bin/phpunit"

# Execute commands which should run after successful build
# We need to symbolic link to /tmp/koseven - dirty hack
after_success:
  - ln -s $(pwd) /tmp/koseven
  - sudo chmod -R 777 build
  - sudo chmod -R 777 /tmp
  - bash <(curl -s https://codecov.io/bash)

# Disable E-Mail notifications
notifications:
  email: false